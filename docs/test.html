<!doctype html>
<notebook theme="glacier">
  <title>Untitled</title>
  <script id="11" type="module">
    Plot.plot({
      marginLeft:100,
      marks:[
        Plot.ruleY([6000000]),
        Plot.lineY(dataEmpleo,
         {
          x:"ano_trimestre",
          y:"chilenos",
                 stroke:d =>"chilenos"

         }
        ),
        Plot.dot(dataEmpleo,
         {
          x:"ano_trimestre",
          y:"chilenos",
          fill:d =>"chilenos"
         }
        ),
      ]
    })
  </script>
  <script id="5" type="application/sql" hidden="" database="duckdb" output="dataEmpleo">
    SELECT ano_trimestre, mes_central,
      sum(fact_cal) as personas,
      sum(CASE WHEN cae_especifico BETWEEN 1 AND 7 THEN fact_cal ELSE 0 END) as ocupados,
      sum(CASE WHEN nacionalidad = 152 AND cae_especifico BETWEEN 1 AND 7 THEN fact_cal ELSE 0 END) as chilenos,
      sum(CASE WHEN nacionalidad <> 152 AND cae_especifico BETWEEN 1 AND 7 THEN fact_cal ELSE 0 END) as extrajeros,
    FROM read_parquet("ene-01-def.parquet")
    GROUP BY ano_trimestre, mes_central
  </script>
  <script id="8" type="application/sql" hidden="" database="duckdb">
    SELECT *
    FROM read_parquet("ene-01-def.parquet")
    LIMIT 10


  </script>
</notebook>
